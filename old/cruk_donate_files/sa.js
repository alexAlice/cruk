(function(){var a = function(){this.sdkVersion = '2.1.0';this.appType = "";this.appVersion = undefined;this.trackId = undefined;this.trackIdReferer = undefined;this.clickToAppId = undefined;this.crmId = undefined;this.sessionId = undefined;this.customerUserJourney = undefined;this.protocol = getWindow().document.location.protocol;this.debug = false;this.activeTrack = true;this.closed = false;this.autoTrack = false;this.online = true;this.stack = [];        this.sessionTime = 1200;        this.processing = false;this.detectUrlPattern = /(\?|&)s4m_id=(.*)|(ctaid=.*)/;this.simplePattern = /^[a-z]+$/;this.alphaPattern = /^[a-zA-Z-0-9]+$/;this.trackIdRefererPattern = /([a-zA-Z-0-9]+)/;this.trackBaseUrl = 'https://eu-mapx.sam4m.com/2.0/app/';this.apiBaseUrl = 'https://eu-ma.sam4m.com/2.0/app/';},b = a.prototype;b.configure = function (config){var that = this;this.debug = config.debug;this.appVersion = config.appVersion;this.autoTrack = config.autoTrack;        this.sessionTime = config.sessionTime || this.sessionTime;if (config.openData) {this.openObj = config.openData;}if ( this.trackId == undefined ){this.setTrackId(config.trackId);}if (config.customerUserJourney != undefined) {this.setCustomerUserJourney(config.customerUserJourney);        }this.bindEvent(getWindow(), 'beforeunload', function(event){if ( !s4m.closed ){_s4mq.push(['trackClose']);s4m.closed = true;}return;});if ( this.autoTrack ){this.bindEvent(getWindow().document, 'click', function (e){var clickedElement=(getWindow().event)                ? getWindow().event.srcElement                : e.target;var name = undefined;if ( undefined != clickedElement.title && '' != clickedElement.title ){name = clickedElement.title;}else if ( undefined != clickedElement.getAttribute('data-title') && '' != clickedElement.getAttribute('data-title') ){name = clickedElement.getAttribute('data-title');}else if ( undefined != clickedElement.getAttribute('data-desc') && '' != clickedElement.getAttribute('data-desc') ){name = clickedElement.getAttribute('data-desc');}else{switch (clickedElement.tagName){case 'A':if ( undefined != clickedElement.href && '' != clickedElement.href ){name = clickedElement.getAttribute('href');}break;case 'IMG':case 'APPLET':case 'AREA':case 'INPUT':if ( undefined != clickedElement.alt && '' != clickedElement.alt ){name = clickedElement.alt;}break;case 'LABEL':case 'OUTPUT':if ( undefined != clickedElement.getAttribute('for') && '' != clickedElement.getAttribute('for') ){name = clickedElement.getAttribute('for');}break;case 'OBJECT':if ( undefined != clickedElement.data && '' != clickedElement.data ){name = clickedElement.data;}break;}}if ( undefined == name && undefined != clickedElement.id && '' != clickedElement.id ){name = clickedElement.id;}if ( undefined != name ){_s4mq.push(['trackAction', {'name' : name, 'uri' : getWindow().document.location.pathname}]);}}, false);}this.nextStack();};b.stringify = function() {"object"!=typeof JSON&&(JSON={}),function(){"use strict";function a(a){return 10>a?"0"+a:a}function h(a){return c.lastIndex=0,c.test(a)?'"'+a.replace(c,function(a){var b=f[a];return"string"==typeof b?b:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function i(a,b){var c,f,j,k,m,l=d,n=b[a];switch(n&&"object"==typeof n&&"function"==typeof n.toJSON&&(n=n.toJSON(a)),"function"==typeof g&&(n=g.call(b,a,n)),typeof n){case"string":return h(n);case"number":return isFinite(n)?String(n):"null";case"boolean":case"null":return String(n);case"object":if(!n)return"null";if(d+=e,m=[],"[object Array]"===Object.prototype.toString.apply(n)){for(k=n.length,c=0;k>c;c+=1)m[c]=i(c,n)||"null";return j=0===m.length?"[]":d?"[\n"+d+m.join(",\n"+d)+"\n"+l+"]":"["+m.join(",")+"]",d=l,j}if(g&&"object"==typeof g)for(k=g.length,c=0;k>c;c+=1)"string"==typeof g[c]&&(f=g[c],j=i(f,n),j&&m.push(h(f)+(d?": ":":")+j));else for(f in n)Object.prototype.hasOwnProperty.call(n,f)&&(j=i(f,n),j&&m.push(h(f)+(d?": ":":")+j));return j=0===m.length?"{}":d?"{\n"+d+m.join(",\n"+d)+"\n"+l+"}":"{"+m.join(",")+"}",d=l,j}}"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+a(this.getUTCMonth()+1)+"-"+a(this.getUTCDate())+"T"+a(this.getUTCHours())+":"+a(this.getUTCMinutes())+":"+a(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()});var c,d,e,f,g;"function"!=typeof JSON.stringify&&(c=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,f={"\b":"\\b","":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},JSON.stringify=function(a,b,c){var f;if(d="",e="","number"==typeof c)for(f=0;c>f;f+=1)e+=" ";else"string"==typeof c&&(e=c);if(g=b,b&&"function"!=typeof b&&("object"!=typeof b||"number"!=typeof b.length))throw new Error("JSON.stringify");return i("",{"":a})})}();};b.parse = function() {"object"!=typeof JSON&&(JSON={}),"function"!=typeof JSON.parse&&(cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,JSON.parse=function(text,reviver){function walk(a,b){var c,d,e=a[b];if(e&&"object"==typeof e)for(c in e)Object.prototype.hasOwnProperty.call(e,c)&&(d=walk(e,c),void 0!==d?e[c]=d:delete e[c]);return reviver.call(a,b,e)}var j;if(text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")});};b.bindEvent = function(obj, eventName, callback) {if (obj.addEventListener){obj.addEventListener(eventName, callback, false);} else if (obj.attachEvent){obj.attachEvent("on"+eventName, function(e){ return callback.call(obj, e); });}};b.trigger = function(eventName, callback) {var event;if (document.createEvent) {event = document.createEvent("HTMLEvents");event.initEvent(eventName, true, true);} else {event = document.createEventObject();event.eventType = eventName;}event.eventName = eventName;if (document.createEvent) {document.dispatchEvent(event);} else {document.fireEvent("on" + event.eventType, event);}if (callback) callback();};b.nextStack = function() {this.processing = false;this.trigger('unStack_s4mq');};    b.checkStatus = function() {if ('onLine' in navigator) {var that = this;this.stack.push = function() {for(var i = 0, l=arguments.length; i < l; i++ ) {Array.prototype.push.call(this, arguments[i]);}that.stackOff();};function connectivity() {that.online = navigator.onLine;}this.bindEvent(getWindow(), 'online', function() {connectivity();if (that.stack.length > 0) {that.defferedTrack();}});this.bindEvent(getWindow(), 'offline', connectivity);connectivity();}};b.activeDebugMode = function(){this.debug = true;this.nextStack();};b.disableTrack = function(){this.activeTrack = false;this.nextStack();};b.activateTracking = function(){this.activeTrack = true;this.track({type: 'txActivation',callback: undefined});};b.deactivateTracking = function(){var that = this;this.track({type: 'txDeactivation',callback: function() {that.activeTrack = false;}});};b.addWebQueryRefererParameters = function(o) {if('object' != typeof o) {this.nextStack();return '';}var uri = o.uri || '',cb = o.callback || function(){},arr = uri.split('#'),qry = uri == '' ? '' : /\?/.test(uri) ? '&' : '?',prm = '';qry += 's4m_id=';if (this.appType) prm += 'tt='+this.appType+'&';if (this.trackId) prm += 'tid='+this.trackId+'&';if (this.crmId) prm += 'cid='+this.crmId+'&';if (this.sessionId) prm += 'sid='+this.sessionId+'&';if (this.customerUserJourney) prm += 'ucj=' + this.customerUserJourney + '&';if (this.clickToAppId) prm += 'ctaid='+this.clickToAppId;qry += encodeURIComponent(prm);arr[0] = arr[0] + qry;cb(arr.join('#'));this.nextStack();};b.getUniqId = function(){var n= Math.floor(Math.random()*11111111),k = Math.floor(Math.random()* 10000000),t = Date.now(),m = n+k+t;m = this.trackId + m;return this.sha1(m);};b.getCrmId = function(){if (this.cookieEnabled) {if( null != this.readCookie('s4m.crmId'+this.trackId)){this.crmId = this.readCookie('s4m.crmId'+this.trackId);}else{this.crmId = this.getUniqId();}this.createCookie('s4m.crmId'+this.trackId, this.crmId, 34186669.8);} else {this.crmId = this.crmId != undefined ? this.crmId : this.getUniqId();}return this.crmId;};b.getSessionId = function(){if (this.cookieEnabled) {if( null != this.readCookie('s4m.sessionId'+this.trackId)){this.sessionId = this.readCookie('s4m.sessionId'+this.trackId);}else{this.sessionId = this.getUniqId();}        this.createCookie('s4m.sessionId'+this.trackId, this.sessionId, this.sessionTime);} else {this.sessionId = this.sessionId != undefined ? this.sessionId : this.getUniqId();}return this.sessionId;};b.isSessionIsAlreadyStarted = function(){if (this.cookieEnabled) {if( null != this.readCookie('s4m.sessionId'+this.trackId)){return true;}} else {if (this.fakeSession) {return true;}}return false;};b.getTrackId = function(callback){if(callback){callback(this.trackId);this.nextStack();}return this.trackId;};b.setTrackId = function(trackId){if(trackId != undefined && this.alphaPattern.test(trackId)){this.trackId = trackId;this.createCookie('s4m.trackId',this.trackId,86400);}else if(this.debug){console.log({message: "trackId is invalid"});}};b.setCustomerUserJourney = function(ucj) {if ( (ucj != undefined) && (this.trackId != undefined)) {this.customerUserJourney = ucj;this.createCookie('s4m.ucj' + this.trackId, this.customerUserJourney, 86400);} else if (this.debug) {console.log({message: "ucj not set no trackid"});}};b.getTrackIdReferer = function(callback){if(callback){callback(this.trackIdReferer);this.nextStack();}return this.trackIdReferer;};b.setTrackIdReferer = function(trackId){if(this.trackIdReferer.match(this.trackIdRefererPattern)){this.trackId = trackId;this.createCookie('s4m.trackIdReferer',this.trackIdReferer,this.sessionTime);}else if(this.debug){console.log({message: "trackIdReferer is invalid"});}};b.detectIds = function() {        var that= this,        reg = this.detectUrlPattern.exec(getUri().search);        if (getDomain(window.location.host).indexOf("doubleclick") != -1) {        if (this.debug) {        console.log({message: "Try to find params in doubleclick uri"});        }        var testDblClick = window.location.href.match(/oref=(.*)$/);        if (testDblClick) {        reg = decodeURIComponent(testDblClick[1]).match(/(\?|&)?s4m_id=(.*)/);        } else {        if (this.debug) {        console.log({message: "No params finded in doubleclick uri"});        }        }        }if (reg) {this.noCookTracking = true;var patIds = reg[2] ? reg[2] : reg[3],dt_ids = decodeURIComponent(patIds).split('&'),ob_ids = {};for (var i = dt_ids.length - 1; i >= 0; i--) {var id = dt_ids[i].split('=');ob_ids[id[0]] = id[1];};if (!ob_ids.tid || !this.alphaPattern.test(ob_ids.tid)) {if(this.debug){console.log({message: "No trackId detected in URI"});}if( null != this.readCookie('s4m.tidSession') && undefined != this.readCookie('s4m.tidSession')) {if(this.debug){console.log({message: "TrackId session finded in cookie"});}this.trackId = this.readCookie('s4m.tidSession');}else if( null != this.readCookie('s4m.trackId') && undefined != this.readCookie('s4m.trackId')){if(this.debug){console.log({message: "TrackId finded in cookie"});}this.trackId = this.readCookie('s4m.trackId');}} else {this.trackId = ob_ids.tid;this.createCookie('s4m.tidSession', this.trackId, this.sessionTime);this.createCookie('s4m.trackId',this.trackId,86400);}if (!ob_ids.ucj || !this.alphaPattern.test(ob_ids.ucj)) {if (this.debug) {                    console.log({message: "No UCJ detected in URI"});}if (null != this.readCookie('s4m.ucj' + this.trackId)) {if (this.debug) {                        console.log({message: "ucj finded in cookie"});}this.customerUserJourney = this.readCookie('s4m.ucj' + this.trackId);}            } else {this.setCustomerUserJourney(ob_ids.ucj);            }if (!ob_ids.tt || !this.simplePattern.test(ob_ids.tt)) {if(this.debug){console.log({message: "No appType detected in URI"});}if( null != this.readCookie('s4m.appType'+this.trackId)){if(this.debug){console.log({message: "appType finded in cookie"});}this.appType = this.readCookie('s4m.appType'+this.trackId);}} else {this.appType = ob_ids.tt;this.createCookie('s4m.appType'+this.trackId,this.appType,86400);}if (!ob_ids.cid || !this.alphaPattern.test(ob_ids.cid)) {if(this.debug){console.log({message: "No crmId detected in URI"});}if( null != this.readCookie('s4m.crmId'+this.trackId)){if(this.debug){console.log({message: "crmId finded in cookie"});}this.crmId = this.readCookie('s4m.crmId'+this.trackId);}} else {this.crmId = ob_ids.cid;this.createCookie('s4m.crmId'+this.trackId,this.crmId, 34186669.8);}if (!ob_ids.sid || !this.alphaPattern.test(ob_ids.sid)) {if(this.debug){console.log({message: "No sessionId detected in URI"});}if( null != this.readCookie('s4m.sessionId'+this.trackId)){if(this.debug){console.log({message: "sessionId finded in cookie"});}this.sessionId = this.readCookie('s4m.sessionId'+this.trackId);}} else {this.sessionId = ob_ids.sid;this.createCookie('s4m.sessionId'+this.trackId,this.sessionId,this.sessionTime);}if (ob_ids.ctaid) {ob_ids.ctaid = ob_ids.ctaid.replace("?", "");}if (!ob_ids.ctaid || !this.alphaPattern.test(ob_ids.ctaid)) {if(this.debug){console.log({message: "No clickToAppId detected in URI"});}if( null != this.readCookie('s4m.clickToAppId')){if(this.debug){console.log({message: "clickToAppId finded in cookie"});}this.trackIdReferer = this.readCookie('s4m.clickToAppId');}} else {                this.clickToAppId = ob_ids.ctaid;this.createCookie('s4m.clickToAppId',this.clickToAppId,this.sessionTime);}if (!ob_ids.tidr || !this.alphaPattern.test(ob_ids.tidr)) {if(this.debug){console.log({message: "No trackIdReferer detected in URI"});}if( null != this.readCookie('s4m.trackIdReferer')){if(this.debug){console.log({message: "TrackIdReferer finded in cookie"});}this.trackIdReferer = this.readCookie('s4m.trackIdReferer');}} else {this.trackIdReferer = ob_ids.tidr;this.createCookie('s4m.trackIdReferer',this.trackIdReferer,this.sessionTime);}if(ob_ids.off) {this.activeTrack = false;this.cookieEnabled = false;}}        else{if( null != this.readCookie('s4m.tidSession') && undefined != this.readCookie('s4m.tidSession')) {if(this.debug){console.log({message: "TrackId session finded in cookie"});}this.trackId = this.readCookie('s4m.tidSession');}else if( null != this.readCookie('s4m.trackId') && undefined != this.readCookie('s4m.trackId') ){if(this.debug){console.log({message: "TrackId finded in cookie"});}this.trackId = this.readCookie('s4m.trackId');}if( null != this.readCookie('s4m.appType'+this.trackId)){if(this.debug){console.log({message: "appType finded in cookie"});}this.appType = this.readCookie('s4m.appType'+this.trackId);}if( null != this.readCookie('s4m.crmId'+this.trackId)){if(this.debug){console.log({message: "crmId finded in cookie"});}this.crmId = this.readCookie('s4m.crmId'+this.trackId);}if( null != this.readCookie('s4m.sessionId'+this.trackId)){if(this.debug){console.log({message: "sessionId finded in cookie"});}this.sessionId = this.readCookie('s4m.sessionId'+this.trackId);}}this.nextStack();    };b.getCurrentDomain = function() {var url = document.location.host;var checkIP = /^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/;if(checkIP.test(url)){return url;} url = url.replace(/\/(.*)/,"");url = url.replace(/\.(([a-z]{2,4})|(com))(\.[a-z]{2})?$/i,"");var subDomain = (url.match(/\./g)) ? true : false;var currentdomain = document.location.host;if(true === subDomain){var separate = currentdomain.split('.');separate.shift();currentdomain = separate.join('.');}return currentdomain;};b.testCookie = function() {document.cookie="s4mCookieEnabled";this.cookieEnabled = (document.cookie.indexOf("s4mCookieEnabled") != -1) ? true : false;};b.createCookie = function(name,value,time,formated){if (time){if (formated) {var expires = '; expires='+time;} else {var date = new Date();date.setTime(date.getTime()+(time*1000));var expires = '; expires='+date.toGMTString();}}else{var expires = '';}var domain = '; domain='+this.getCurrentDomain();document.cookie = name+'='+value+expires+domain+'; path=/';if (null == this.readCookie(name)) {if(this.debug) console.log("NO COOKIE CREATED");this.cookieEnabled = false;};};b.readCookie = function(name){var nameEQ = name + '=';var ca = document.cookie.split(';');for(var i=0, cl=ca.length;i < cl;i++){var c = ca[i];while (c.charAt(0)==' '){c = c.substring(1,c.length);}if (c.indexOf(nameEQ) == 0){return c.substring(nameEQ.length,c.length);}}return null;};b.stackOff = function() {var that = this,stck = this.readCookie('s4m.offline'),pipe = '';if (stck) {pipe += stck + '|';}pipe += this.stack.join('|');this.stack.length = 0;this.createCookie('s4m.offline', pipe, 3600);this.nextStack();};b.defferedTrack = function() {var that = this,stck = this.readCookie('s4m.offline');if (!stck) return;var pipe = stck.split('|');while (pipe.length > 0) {if (!that.online)return false;var px = new Image();px.src = pipe.shift();}if (pipe.length > 0) {this.stack.push.apply(this, pipe);}this.nextStack();};    b.castIntegerToDate = function(a) {        var r = String(a);        if ( r.length === 1 ) {            r = '0' + r;        }        return r;    };b.track = function(action){if(this.debug) console.log(action);try{if(!action) {this.nextStack();throw {message: "no track informations"};}var callback = "function" == typeof action.callback ? action.callback : function() {};if(!this.activeTrack || (!this.cookieEnabled && !this.noCookTracking)){this.fakeSession = true;callback();this.nextStack();return true;}if(this.trackId == undefined){callback();this.nextStack();throw {message: "trackId must be defined"};}else if(!this.alphaPattern.test(this.trackId)){callback();this.nextStack();throw {message: "trackId is invalid"};}var px = new Image();px.onload = callback;px.onerror = callback;if (action.unicity && action.unicity.on && action.unicity.time){var cookieKey = action.type;for(var i= 0, l=action.unicity.on.length; i<l; i++){cookieKey += '.'+action[action.unicity.on[i]]+';';}var time = 0;switch (action.unicity.time){case 'session':cookieKey += this.sessionId;break;case 'user':cookieKey += this.crmId;break;default:time = action.unicity.time;break;}cookieKey = 's4m.'+this.sha1(cookieKey);if( null != this.readCookie(cookieKey)){if(this.debug) console.log(cookieKey+" already tracked.");callback();this.nextStack();return true;}else{this.createCookie(cookieKey,1,time);}}var d = new Date(),offset = d.getTimezoneOffset(),date = d.getFullYear() + '-' + this.castIntegerToDate((d.getMonth() + 1)) + '-' + this.castIntegerToDate(d.getDate()) + 'T' + this.castIntegerToDate(d.getHours()) + ':' + this.castIntegerToDate(d.getMinutes()) + ':' + this.castIntegerToDate(d.getSeconds());if(offset < 0 ){offset = offset * -1;date += '+';}else{date += '-';}hour = parseInt(offset / 60);date += this.castIntegerToDate(hour) + ':'+this.castIntegerToDate(parseInt(offset - (hour * 60)));var src = this.trackBaseUrl+this.trackId+'/event/'+action.type+'/create?ea='+encodeURIComponent(date);if (this.customerUserJourney)                    src += '&ucj=' + encodeURIComponent(this.customerUserJourney);switch (action.type){case 'connection':case 'disconnection':case 'close':case 'txDeactivation':case 'txActivation' :break;case 'open':                    if ( this.isSessionIsAlreadyStarted() ){src = '';if(this.debug) console.log('Session '+this.getSessionId()+' already opened.');break;}var devicePixelRatio = window.devicePixelRatio,screenWidth = window.screen.width,screenHeight = window.screen.height,ua = navigator.userAgent;if ( ua.match(/(iPad|iPhone|iPod)/g) ){screenWidth =  screenWidth * devicePixelRatio;screenHeight = screenHeight * devicePixelRatio;}else if ( ua.match(/(Android)/g) && ua.match(/(Chrome)/g) ){screenWidth =  screenWidth * devicePixelRatio;screenHeight = screenHeight * devicePixelRatio;}else if ( ua.match(/(Android)/g) && ua.match(/(Firefox)/g) ){screenWidth =  screenWidth * devicePixelRatio;screenHeight = screenHeight * devicePixelRatio;}if(screenWidth < screenHeight){var tmpWidth = screenWidth;screenWidth = screenHeight;screenHeight = tmpWidth;}var language = (navigator.language) ? navigator.language : navigator.userLanguage;src += '&eb='+encodeURIComponent(this.appVersion)+'&da='+encodeURIComponent(ua)+'&dd='+encodeURIComponent(screenWidth)+'&de='+encodeURIComponent(screenHeight)+'&df='+encodeURIComponent(devicePixelRatio)+'&dg='+encodeURIComponent(date)+'&dh='+encodeURIComponent(language);if (this.clickToAppId){src += '&uc='+encodeURIComponent(this.clickToAppId);}if (action.deviceAdvertiserId) src += '&ub='+action.deviceAdvertiserId;if (action.fbId) src += '&ud='+action.fbId;if (action.deviceTokenId) src += '&ue='+action.deviceTokenId;                    break;case 'browsing':if (action.title) src += '&ei='+encodeURIComponent(action.title);if (action.uri) src += '&ej='+encodeURIComponent(action.uri);break;case 'action':var regex1 = RegExp('^S[0-9]+$');var regex2 = RegExp('^S(3|6|9)$');if ( regex1.test(action.name) && !regex2.test(action.name) ){this.nextStack();    return true;}if (action.name) src += '&eh='+encodeURIComponent(action.name);if (action.uri) src += '&eu='+encodeURIComponent(action.uri);break;case 'search':if (action.query) src += '&eg='+encodeURIComponent(action.query);break;case 'purchase':if (action.purchaseType) src += '&ed='+encodeURIComponent(action.purchaseType);if (action.products) src +='&ee='+encodeURIComponent(action.products);if (action.price || action.price === 0) src += '&ef='+encodeURIComponent(action.price);if (action.currency) src += '&ec='+encodeURIComponent(action.currency);if (action.credits || action.credits === 0) src += '&ew='+encodeURIComponent(action.credits);if (action.paymentType) src += '&ev='+encodeURIComponent(action.paymentType);if (action.promoCode) src += '&ex='+encodeURIComponent(action.promoCode);if (action.priceOfGiftVoucher || action.priceOfGiftVoucher === 0) src += '&ey='+encodeURIComponent(action.priceOfGiftVoucher);if (action.creditsOfGiftVoucher || action.creditsOfGiftVoucher === 0) src += '&ez='+encodeURIComponent(action.creditsOfGiftVoucher);break;case 'share':if (action.sharingType) src += '&en='+encodeURIComponent(action.sharingType);if (action.label) src+= '&eo='+encodeURIComponent(action.label);if (action.uri) src += '&ep='+encodeURIComponent(action.uri);break;case 'subscription':if (action.label) src += '&eq='+encodeURIComponent(action.label);break;case 'unsubscription':if (action.label) src += '&et='+encodeURIComponent(action.label);break;case 'lead':if (action.label) src += '&er='+encodeURIComponent(action.label);if (action.uri) src += '&es='+encodeURIComponent(action.uri);break;case 'updateuserdata':src = this.trackBaseUrl+this.trackId+'/user/'+this.getCrmId()+'/update?ea='+encodeURIComponent(date);if (action.userId) src += '&ua='+action.userId;if (action.deviceAdvertiserId) src += '&ub='+action.deviceAdvertiserId;if (action.deviceTokenId) src += '&ue='+action.deviceTokenId;if (action.gender) src += '&us='+encodeURIComponent(action.gender);if (action.email) src += '&uh='+encodeURIComponent(action.email);if (action.phoneNumber) src += '&ui='+encodeURIComponent(action.phoneNumber);if (action.firstname) src += '&uj='+encodeURIComponent(action.firstname);if (action.lastname) src += '&uk='+encodeURIComponent(action.lastname);if (action.birthday) src += '&ul='+encodeURIComponent(action.birthday);if (action.thematic) src += '&um='+encodeURIComponent(action.thematic);if (action.isOptin) src += '&un='+encodeURIComponent(action.isOptin);if (action.country) src += '&uo='+encodeURIComponent(action.country);if (action.region) src += '&up='+encodeURIComponent(action.region);if (action.city) src += '&uq='+encodeURIComponent(action.city);if (action.language) src += '&ur='+encodeURIComponent(action.language);break;default:this.nextStack();throw {message: "Tracking type is unknown"};break;}if(action.geoloc) {if (action.geoloc.latitude) src += '&uf='+action.geoloc.latitude;if (action.geoloc.longitude) src += '&ug='+action.geoloc.longitude;}if(action.userData) {if (!(JSON && 'function' == typeof JSON.stringify)) this.stringify();src += '&uz='+encodeURIComponent(JSON.stringify(action.userData));}if ( '' != src ){src += '&s='+this.getSessionId()+'&u='+this.getCrmId()+'&em='+this.getUniqId();if (this.online) {                    px.src = src;}else{this.stack.push(src);}}if (action.type == 'open') {this.fakeSession = true;this.createCookie('s4m.sessionId'+this.trackId,this.sessionId,this.sessionTime);}this.nextStack();}catch(err){if(this.debug){console.log(err);} this.nextStack(); return false;}return true;};b.ps = function(type, o){if(/^(configure|activeDebugMode|activateTracking|deactivateTracking|disableTrack|get(.+)?|set(.+)?|add(.+)?|detectIds)$/i.test(type)) return this[type](o);if (this.trackId == undefined) {this.processing = false;return;}var obj = {type: type.toLowerCase().replace('track', ''),callback: undefined};if('trackOpen' === type && this.openObj && !o) {var o = this.openObj;}if(o) {for(var prop in o) { obj[prop] = o[prop]; }}        if ( obj.type != 'open' && !this.isSessionIsAlreadyStarted() )        {            if(this.debug) console.log({message: 'Session is dead. Restart session'});            var that = this;            _s4mq.unshift([type, o]);            return this.track({type:'open'});        }else        {            return this.track(obj);        }};b.utf8_encode = function(argString) {if (argString === null || typeof argString === "undefined") {return "";}var string = (argString + '');var utftext = '', start, end, stringl = 0;start = end = 0;stringl = string.length;for (var n = 0; n < stringl; n++) {var c1 = string.charCodeAt(n);var enc = null;if (c1 < 128) {end++;} else if (c1 > 127 && c1 < 2048) {enc = String.fromCharCode((c1 >> 6) | 192, (c1 & 63) | 128);} else if (c1 & 0xF800 != 0xD800) {enc = String.fromCharCode((c1 >> 12) | 224,((c1 >> 6) & 63) | 128, (c1 & 63) | 128);} else { if (c1 & 0xFC00 != 0xD800) {throw new RangeError("Unmatched trail surrogate at "+ n);}var c2 = string.charCodeAt(++n);if (c2 & 0xFC00 != 0xDC00) {throw new RangeError("Unmatched lead surrogate at "+ (n - 1));}c1 = ((c1 & 0x3FF) << 10) + (c2 & 0x3FF) + 0x10000;enc = String.fromCharCode((c1 >> 18) | 240,((c1 >> 12) & 63) | 128, ((c1 >> 6) & 63) | 128,(c1 & 63) | 128);}if (enc !== null) {if (end > start) {utftext += string.slice(start, end);}utftext += enc;start = end = n + 1;}}if (end > start) {utftext += string.slice(start, stringl);}return utftext;};b.sha1 = function(str) {var rotate_left = function(n, s) {var t4 = (n << s) | (n >>> (32 - s));return t4;};var cvt_hex = function(val) {var str = "",i,v;for (i = 7; i >= 0; i--) {v = (val >>> (i * 4)) & 0x0f;str += v.toString(16);}return str;};var blockstart,i, j,W = new Array(80),H0 = 0x67452301,H1 = 0xEFCDAB89,H2 = 0x98BADCFE,H3 = 0x10325476,H4 = 0xC3D2E1F0,A, B, C, D, E,temp;str = this.utf8_encode(str);var str_len = str.length;var word_array = [];for (i = 0; i < str_len - 3; i += 4) {j = str.charCodeAt(i) << 24 | str.charCodeAt(i + 1) << 16| str.charCodeAt(i + 2) << 8 | str.charCodeAt(i + 3);word_array.push(j);}switch (str_len % 4) {case 0:i = 0x080000000;break;case 1:i = str.charCodeAt(str_len - 1) << 24 | 0x0800000;break;case 2:i = str.charCodeAt(str_len - 2) << 24| str.charCodeAt(str_len - 1) << 16 | 0x08000;break;case 3:i = str.charCodeAt(str_len - 3) << 24| str.charCodeAt(str_len - 2) << 16| str.charCodeAt(str_len - 1) << 8 | 0x80;break;}word_array.push(i);while ((word_array.length % 16) != 14) {word_array.push(0);}word_array.push(str_len >>> 29);word_array.push((str_len << 3) & 0x0ffffffff);for (blockstart = 0, wa = word_array.length; blockstart < wa; blockstart += 16) {for (i = 0; i < 16; i++) {W[i] = word_array[blockstart + i];}for (i = 16; i <= 79; i++) {W[i] = rotate_left(W[i - 3] ^ W[i - 8] ^ W[i - 14]^ W[i - 16], 1);}A = H0;B = H1;C = H2;D = H3;E = H4;for (i = 0; i <= 19; i++) {temp = (rotate_left(A, 5) + ((B & C) | (~B & D)) + E + W[i] + 0x5A827999) & 0x0ffffffff;E = D;D = C;C = rotate_left(B, 30);B = A;A = temp;}for (i = 20; i <= 39; i++) {temp = (rotate_left(A, 5) + (B ^ C ^ D) + E + W[i] + 0x6ED9EBA1) & 0x0ffffffff;E = D;D = C;C = rotate_left(B, 30);B = A;A = temp;}for (i = 40; i <= 59; i++) {temp = (rotate_left(A, 5) + ((B & C) | (B & D) | (C & D))+ E + W[i] + 0x8F1BBCDC) & 0x0ffffffff;E = D;D = C;C = rotate_left(B, 30);B = A;A = temp;}for (i = 60; i <= 79; i++) {temp = (rotate_left(A, 5) + (B ^ C ^ D) + E + W[i] + 0xCA62C1D6) & 0x0ffffffff;E = D;D = C;C = rotate_left(B, 30);B = A;A = temp;}H0 = (H0 + A) & 0x0ffffffff;H1 = (H1 + B) & 0x0ffffffff;H2 = (H2 + C) & 0x0ffffffff;H3 = (H3 + D) & 0x0ffffffff;H4 = (H4 + E) & 0x0ffffffff;}temp = cvt_hex(H0) + cvt_hex(H1) + cvt_hex(H2) + cvt_hex(H3)+ cvt_hex(H4);return temp.toLowerCase();};var s4m = new a();s4m.testCookie();s4m.checkStatus();_s4mq = (_s4mq!='undefined' && _s4mq instanceof Array) ? _s4mq:[];_s4mq.push = function () {for(var i = 0, l=arguments.length; i < l; i++ ) {Array.prototype.push.call(this, arguments[i]);}queue();};_s4mq.unshift = function () {for(var i = arguments.length-1; i >= 0 ; i-- ) {Array.prototype.unshift.call(this, arguments[i]);}queue();};    var index = 0,    initd = false;    if ( _s4mq.length > 0 && _s4mq[0].length > 0 && _s4mq[0][0] == 'configure' )    {        index = 1;    }        _s4mq.splice(index, 0,        ['detectIds'],        ['trackOpen'],        ['trackBrowsing', {title: getWindow().document.title, uri: getWindow().document.location.pathname}]);    s4m.bindEvent(document, 'unStack_s4mq', processQueue);    queue();function queue() {var whenReady = function(callback) {  if (initd || document.readyState === 'complete') {  callback();   }  else {  window.setTimeout(function() {  initd = true;  callback();  }, 1000);  }  },queueStack = function() {if (!s4m.processing) processQueue();};whenReady(queueStack);};function processQueue() {var ping = _s4mq.shift();if (ping) {s4m.processing = true;try{s4m.ps(ping[0], ping[1]);}catch(err){console.log(err.message);};}};    function inIframe () {        try {            return window.self !== window.top;        } catch (e) {            return true;        }    };    function isIP(hostname) {        var parts = hostname.split('.');        if (parts.length == 4 && /^\d+$/.test(hostname.replace(/\./g, '')))        {            return true;        }        return false;    };    function getDomain(hostname) {        var domain = hostname;        if ( !isIP(hostname) )        {            var parts = hostname.split('.');            var subdomain = parts.shift();            domain = parts.join('.');        }        return domain;    };    function getWindow()    {        return (inIframe() && getDomain(window.location.hostname) == getDomain((document.referrer != "" ? new URL(document.referrer).hostname : ""))) ? window.parent : window;    };    function getUri()    {    return (window.location != window.parent.location) ? (document.referrer != "" ? new URL(document.referrer): window.location): document.location;    };})();